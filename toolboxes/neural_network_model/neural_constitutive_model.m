function [Y,Xf,Af] = neural_constitutive_model(X,~,~)
%NEURAL_CONSTITUTIVE_MODEL neural network simulation function.
%
% Auto-generated by MATLAB, 08-Jul-2019 19:45:14.
% 
% [Y] = neural_constitutive_model(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 6xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-23.3929419517349;-6.82181357482293;-109.580220852405;-3.53995776976608;-40.5499579446075;-2.77928894687193];
x1_step1.gain = [0.0427478488588736;0.14377763739457;0.00914840734676847;0.282780913775992;0.024654387258668;0.359732918252543];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.1326768363996578548;0.074774890945672883857;-0.31640256811305261797;0.27905816260234095338;-0.3786529622718828314;0.35250859392225902811;-0.13196017983826030529;0.084333740595021661202;-0.70276618039884941602;0.083288676520111404322;0.56330058208353694926;0.42428852181788073716;0.34122912794397114444;0.63528592858701582458;-0.13817172927796728121;0.16848475253618971914;0.3800153360106521272;-0.92902556475012931791;0.48485927195080047447;-0.0088021483418630145495;0.34956982796179503215;1.062058426659748589;-0.51486816868056195506;-0.24195471720818939598;-0.13614771290093635736;0.063665598731973416236;-0.0915330317697728435;-0.00064200128803185759624];
IW1_1 = [-0.22101140191493728882 0.38549501434171784542 -0.31701010853958389024 -0.11152458856816281629 -0.13246342899862637021 0.058360381362010396722;0.37570330234458482188 -0.41195784723102385483 -0.11331672377684257058 -0.05132845132599417326 -0.024017859031094948574 -0.073831572413754043005;-0.11514499539839721798 0.65621630631332483752 0.31656004614800586916 0.16898713652101760019 -0.39075665182082175431 0.23761161426196858448;0.44975731046466238539 -0.3768079065555103857 0.062182512614665973183 -0.10540352431668408018 0.085827169182864940233 0.090434736261324352724;-1.4031597858441378079 0.21763775796686918307 0.4618544084936708205 0.11083767248049535004 0.30340101622658183222 0.098917921208622361373;-0.57907889582690130759 -0.096515201244487314192 -0.064146885528915995045 0.33335716250749386491 -0.53511153107574727095 0.12308958113752925534;-0.43039904060964717658 0.28355213519590022342 0.082890002532421569459 0.64322461774331285422 -0.24555861533549788733 -0.34616284276237618833;0.30800476921006769704 -0.53682339794960443058 0.31554722143429753123 0.16662470949071497839 0.051911195986592703622 -0.61008231905597176681;0.85169998657418022336 0.66770942403849531388 -0.11723240609657127609 -0.34470495745251150677 -0.40167492980810964864 0.0049462939850815172693;0.054851715034318952735 -0.77756178143019250015 -0.55760700756960757118 -0.091457190110997940713 0.21293243224555175042 -0.64462998402301463496;0.16539644943681827693 -0.56374885243006545021 -0.42637020285806448427 -0.30707601482878676968 -0.72907212867456572258 -0.36204748883472603893;-0.24880170045987043403 -0.022656188210791329551 0.50674194380279835581 -0.16440127468280207879 0.73257997263994834025 0.45409523489773423455;-0.34253893313499117479 0.16182847877041892093 -0.42209428804571080818 -0.3244179133268548787 -0.23347739861348745793 0.66913328080219680594;-0.83110841039692950893 -1.2666129917310624542 -0.7396479549671863829 -0.078718057277069666822 0.40348490598272779284 -0.19150147452450200225;0.61327264533740821761 0.17546919667445931568 0.63837164849941674394 -0.23656837847292666588 -1.001153481661601008 -0.31189216217219895011;1.3778564542249998048 0.40635844227098516512 0.51777056665879728214 -0.49947444614490110748 -0.27406203132347661811 0.22602692776016558573;0.29051664948425159896 -0.68023688217742006579 0.37212640212917019733 -0.16837008089396901522 -0.72156957318116377031 0.12514711320605897971;-0.54629478957503163628 0.41809043462261336055 0.26728888873499562218 0.26666390877399492876 0.10037837313874459211 0.7088889506821121067;0.42674611610373403003 -0.88337852782327919154 -0.12452745146794048925 0.12571809977019074434 0.5580864573672463802 0.50639243146975965182;-0.26729342212507045673 -1.0876718028008742767 -0.94109622339867182728 -0.012192753755108167585 -0.19387963603866534279 -0.11384840692129860606;0.87135696402507833991 0.26569349153122023832 0.26841707514788365474 0.091154174783678182381 -0.076247124495672918831 0.40302499403979658021;0.51427004538402898426 -1.3793361187601351769 -0.79297887731576333081 -0.094254252952938238908 -0.51551883357579897371 0.14195957787802573891;-0.042453321370520935574 -0.55481891547181971802 -0.2477165340232068691 0.27658140044693468873 0.12213029213352827318 -0.51865074695751856027;0.20317132869582293919 -0.73293954517868109555 -0.45591489654923905706 0.30566079147140728933 9.8608530716245285097e-05 0.036690214739190853133;-0.11384264204678150312 -0.14917120953945633977 -0.27188797336541936644 -0.056458394802397400547 -0.00023723519849880650434 0.070350889079994552433;-0.15179855783225046362 -0.54147102756128917544 -0.38535577764932327227 -0.27123250715835567348 0.22374159116268760306 -0.30338140666207347174;0.15859849888417154595 -0.030633352248325688982 -0.25931713118120586214 0.40459098430439244254 0.20536884110470635112 -0.013966816962531141549;0.10382329218488843547 0.055244465299244913115 0.051077400622262167373 0.11002166311120832598 -0.11788585369774909339 0.025334052224587799013];

% Layer 2
b2 = [0.26999051626243608659;-0.12304986635726417044;-0.0728851399246335796;-0.18642796105610154322;-0.075060176596576225205;-0.11170434112849197961;0.0020769477200123643949;0.17526057956924212533;0.50261269755112158997;-0.21227451562834884213;0.13756924601564429755;0.18425231053745394494;-0.26944752297222429593;-0.17800651359369321081];
LW2_1 = [-0.21237142300740982637 -0.10382463434385959256 -0.1818413370741791546 -0.23976260582135006105 0.19155856984519711861 -0.20456475547320743247 0.23005117021103929642 0.36719123133021558392 -0.59065356891017095631 0.28141068620635412145 0.15872280502297547722 -0.57032509012081877842 0.22655052549263365869 -0.22854200177974984265 0.20766821731536108664 0.048722341098161356387 0.26721074773929420765 0.0999924088664285865 0.47518337219711398456 0.39001712608453265041 0.33486291177598531688 -0.27464717203517352573 -0.1082804290031989386 -0.47045689403098178705 0.11407647990742002253 -0.14261724564321087705 0.28771156039412887351 0.12808182832637671211;-0.06881127749236480573 -0.20054926359099534139 -0.16642750463375879932 -0.050405159989778888785 0.26887719165545731492 0.26852212285830584504 0.13634728645177582318 -0.40153857188595865058 0.17264304868420460304 0.070892489778235839859 0.3848608234768994274 -0.017955142444003806268 -0.28169645141424259904 0.25527747274072165595 0.12080643288528293555 0.39947657457772156597 -0.47246819587821842212 0.015895389465198007939 0.20355179875643428233 -0.12620278355017036653 -0.032344130950398702895 0.058508002078382859157 -0.18431554627845270211 0.082957012550029532449 -0.053582913048535671385 0.0074373583649372260879 -0.064367527881491332087 -0.0014732285253200349054;-0.079699458485069610281 -0.081415572261321858538 -0.16817521089542969426 -0.051043651502458285696 -0.38644272584981742558 0.11072349834121578138 0.16856326558307424546 -0.15965543651072161557 0.30026127085364606728 -0.24039908030897849667 -0.17446736609370305793 0.19525823975383010955 -0.10508248079116901119 0.18795263395345593316 0.051965279075014005061 -0.089658075589380645254 0.0074710128976142623977 0.28019832712002123998 -0.40493994559162965752 -0.15902044463431916355 -0.21307625635965041222 0.2351813899582613776 -0.042011216166973959496 0.37366941568128203555 0.21725827887982102071 0.14792947050341287429 -0.1284556980158884365 0.12553753579559298603;0.17977374704266263494 -0.10016714759242888177 0.3048156934802340734 0.0042116892813142490365 -0.18249141340507593623 0.00074206425657671187812 -0.29339569009280430656 -0.27354950802749217198 -0.24443559497578840056 0.17960933913777726856 -0.16140636965815191584 -0.19372079152772103683 -0.42064159654832433688 -0.054410399213529345164 0.0018720476612995697388 -0.313933723167859835 0.22484386350163404478 0.051261665045393541018 0.17631271116412930433 -0.35592784232999746807 -0.17825471295421405071 0.27318441549764771459 -0.23355421827529901369 0.053903009403955155776 -0.014454070498481255691 0.030920278577627559324 -0.019366217621788497233 -0.041324375436422526586;0.07728614345181625267 0.2022478746192896415 0.10113221709621712796 -0.012742025868468967453 -0.12367505275260173847 -0.066261874706564416471 -0.12226439045849310516 0.059067440587949382458 -0.042893513189108632699 -0.025499177091530912664 -0.18830573316085508218 0.0003029687277686936471 -0.20087298409742701533 0.039763296081566118501 -0.16435493655284402759 -0.050559212944635889553 -0.20832669299570197308 0.12337835602011253122 0.026012386019453475478 -0.3018486972259883383 -0.24231753569493047484 0.20443226509280751357 0.14010283215540794699 0.011194542431479714839 -0.000365540393241655737 -0.0031574903654043237622 -0.43165879171658283475 0.030536047402550416802;0.026828352719652278496 -0.0033887732620552467322 0.076949208394119061882 0.10011458908479553553 -0.77295843019692722642 0.101435857515137548 -0.49411039035181952839 0.24223512553371315259 -0.44412183704383556559 -0.027920532557611510427 0.045250277693957896563 -0.271598794169884028 0.25398921840321592169 -0.071723738055849972639 -0.20368117972837845864 -0.58360876926155924593 0.28628141392905370743 0.068845584845822468956 -0.034447636657225735868 -0.42040783266016173991 0.10364158985344748554 -0.62452326246993250525 0.077067697137182603062 0.0029828154065497519687 0.014691440674778545594 0.021594040806452930586 0.21846648264572604559 0.10479884518769977397;-0.0010120903183140758305 0.6420975123813030816 0.29664657097522501017 -0.13036243565401831046 0.65192944223387927494 -0.4060243782208935448 0.0072389180363476527541 0.11029756750423941325 -0.038142350049847680016 -0.30096871032838418136 0.23354770940598268414 0.11579115681358374823 -0.12984881710969084501 0.12849744495297726887 -0.1489325990784692022 0.17409007623620928462 -0.10163094060588531709 0.41762595228952303916 -0.023350194134484737046 -0.24756516130708844381 -0.055228649449998716559 0.70672263287336645199 0.76328987276078075208 -0.25229619455985219378 0.20913720764102899929 -0.048267710604153593601 0.01034554219937686842 -0.01001767775452910153;-0.30845880637415845626 0.028897745297554025545 -0.29180403803753784953 -0.26178566768236383178 0.013736910105234062529 0.2837224569459148027 0.58661292739302661747 0.26373328871036749721 0.031095705666928513677 0.27006400176919348466 0.59866263204051095581 0.50637343865448580793 -0.078583723704654065423 -0.055428267334411258915 0.28332508320326466045 -0.014410262277680526213 0.22703318994824331356 -0.044693848067338781682 0.14452926987642258916 0.40108002684054849807 0.30747452058952234877 -0.010056349338949078023 -0.18270974100584932986 -0.091245955200396050566 -0.11339505965424888367 -0.093583898839405502135 0.43132381530858276975 0.25025249903792662343;-0.13998141274236780562 0.056923409684120421237 -0.27408979880968009635 -0.23597917931733586316 0.36851418508194366819 0.22461600584334406872 0.14566523063755579259 0.15511642924783930475 -0.22684554895857619861 0.1699045739485565143 0.38619828435965775082 0.25627383217977167673 0.41253382171945662815 -0.48776745234944818286 -0.011943921317866569576 0.48398579161713234376 -0.11526632796407346171 0.3173464673393708857 -0.11250843949906658148 0.79751335610772433604 0.65095999559122064149 -1.1204059394808827399 0.011267116225132890392 -0.14163534917164607996 -0.0025494492331765410825 0.26922178665833829125 0.27137190873489580589 -0.12775991085605972741;0.54640995431638361701 0.74300364561138587671 0.099873015274794085805 -0.062684649637085559926 -0.14183065798028160476 -0.27986652522006583155 0.35078623175827938763 -0.18800979758787103591 0.48404407347904299108 -0.17503892742980117769 -0.40580673503892134013 0.15132275219371607577 -0.051426346049069690536 0.043727351369415551341 -0.38407310863119231703 0.039794894859320674441 0.11399288905753279799 0.36707513096931948526 0.20898843806802422374 -0.29113836708956286614 -0.67502815946854288764 0.98990700823952093579 0.068325984799369091083 0.26241431317249830357 -0.13504603431495393329 -0.14670877287880074169 -0.48170088365526109175 0.063383475391502214213;-0.070207554892277021508 0.023883249443180851884 0.35897438774006157347 0.16946654695743593178 0.041753326729554826602 -0.20020783430955674254 -0.54384785161213122784 -0.13751179524623838302 -0.15553152792805213789 -0.26895947000468001242 -0.47521264768395926614 -0.083318234092697077142 -0.53206683066050564079 0.10831159079671576206 0.054885901244587489978 -0.17021460036789998194 -0.21616951285112476211 -0.25447835662146456315 -0.19418113629318303759 0.13075022554707371736 -0.19027189024492160985 0.24730171827604649493 -0.28519319751277760755 0.1331732310410614073 -0.090791729017272879143 -0.23702333382643572812 -0.15416069833390486088 0.038105702047291578616;0.24072761810791334924 0.086859300356650917529 -0.18026795474535681207 -0.11776128899976856523 0.27470360106623048502 0.15817338884529266729 0.18955513623624437036 -0.34265422010534007935 -0.44583892664898860936 0.80032344246575892743 0.10570578948067613223 0.26267527978225335694 0.3054959401539646402 -0.36013502043894307647 0.28714350965619345191 0.682163442824442523 0.051930069866230943454 0.49844035626068561307 -0.034580739640207622254 0.13476631743617878412 0.24337540696065446122 -0.60920874997566043518 -0.080759300248513424259 0.20125529709971098913 -0.22022819110599436976 0.23080050305787150333 0.2396665503349737214 -0.066851667457762636859;0.12817200604305117873 0.050600898604341554288 -0.58688618838153394641 -0.29602003240549806806 0.21963508169909032319 0.25766436218580546225 0.045602240515725790682 -0.2783225251404122802 -0.25933814071977545623 0.084710202799940861884 1.026394818772885742 0.59779521646624744768 -0.14194801342187465809 -0.35595664410072447303 0.097970234079750445622 -0.027136388654867546477 -0.12616300950817821436 -0.33824575740425738557 -0.31842304487103439969 0.22329311822284958478 1.0142292851241474505 -1.1302178032985337186 -0.16759701864418699579 0.52167130879450163139 0.092023928153009165731 0.30651555964864296566 0.11231028822683444823 0.04689898015225549277;0.11634721037199854954 -0.27096871372404984779 -0.31912618964541816791 0.039894864621484164846 0.23539618258860128819 0.098347078423915448853 -0.0078876255628857923352 -0.58469489137614216734 -0.11932652987960037927 0.02872127118313140548 -0.10169278067768205975 -0.083739261055105165821 -0.4040396189012264716 0.0090761516633477493099 0.16417601721652941293 0.13940668500950456621 -0.18755124922413149435 -0.43101219655775441231 0.028583059446966069261 0.094376356336429989558 0.24528161756913258174 -0.084691718755996181489 -0.11473758851221835253 0.22888356648924607084 -0.093669022607637930644 -0.10319316667655319131 -0.34146830267987221541 -0.006579885262905820105];

% Layer 3
b3 = [0.64457872152875483884;0.65163737056279757986;-0.62770094945463428271;-0.50141387334377252039;0.75768850608509130673;-0.3343201921735977078];
LW3_2 = [-0.20551419789754260536 0.083191807362351155586 -0.58144412334904216344 0.15646818860688888053 0.12778553492595512431 -0.54580196793676771794 0.13971955653884526871 0.15055273227827531413 -0.33674284653037012127 -0.059787101714252263718 0.19888379561031588327 -0.49437150836156718015 -0.31755804681589594463 -0.1532024583778576754;-0.011061461868140248788 0.25404090623775321678 -0.57915568737157618884 0.010335174754140563289 0.067428881888967770464 -0.50940039054500874105 -0.0082059617455372546591 0.019826305536081587771 -0.21152057399192458753 -0.010956050129574153654 0.28589032595238988987 -0.80985878458104909594 -0.26241846288207132387 -0.49796152324018205793;0.15904327885785690677 -0.21163300965487202854 0.060214176456047444064 0.21217482710678595148 -0.30290412525737603344 0.55385922984489655008 -0.03035181388764193397 -0.13259525676812372597 0.3623893014516619826 -0.12151895972783703648 -0.32416945077653491758 0.606193009676930461 0.22184077949151753684 0.31499233487070854576;0.16786206080327839563 -0.18190139536320795721 -0.038441982310057673522 -0.067501693344755975268 -0.052689565739207473716 0.29697786112403590231 -0.22959249685636975991 -0.14209526602659050543 0.22691415819785945573 0.043513997808853448201 -0.15647216238625505369 0.38880573128881490419 -0.13264686411087492357 0.017747636700726161785;0.1812223956382197354 0.082897139800111069308 -0.28723951623523585885 0.097194248915992764726 -0.24942786400355157483 -0.52485408609988293271 0.17273863772374720149 -0.11756997862399665156 -0.18784646394927248525 -0.041392506505729370625 0.11718120787504569813 -0.30627667169506483935 -0.5459749397693536288 -0.2521513670266900542;0.17543190590356536052 -0.20099961019847295551 -0.26604605759431870782 -0.092222589610014921169 0.13962252612199479995 0.21722208733243386636 -0.052968286927447594259 -0.15117019232320805244 0.14638842123799244987 0.0031605227865793587491 -0.15642327759359231365 0.57900960308636406637 -0.50890924924737657165 0.023872560056270406004];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [360598.900035328;338621.007525014;174632.27451349;15289687.1527248;1059460.40886051;9825887.74739805];
y1_step1.xoffset = [-4.67758881971714e-06;-4.96195397685693e-06;-1.81309392577192e-06;-2.85586504126826e-08;-1.64288385142222e-06;-6.08156708317307e-08];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = poslin_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Linear Positive Transfer Function
function a = poslin_apply(n,~)
  a = max(0,n);
  a(isnan(n)) = nan;
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
